(async function(){const data=await TravelData.getDays(); const select=document.getElementById('daySelect'); const gallery=document.getElementById('gallery');
(data||[]).sort((a,b)=>new Date(a.date)-new Date(b.date)).forEach(d=>{if(!select) return; const o=document.createElement('option'); o.value=d.id; o.textContent=`${d.date} â€“ ${d.title}`; select.appendChild(o);});
function derive(p){const b=p.replace(/^images\//,'').replace(/\.[^.]+$/,''); return {webp800:`images/opt/${b}-800.webp`, webp1600:`images/opt/${b}-1600.webp`, jpg1600:`images/opt/${b}-1600.jpg`, original:p};}
function pic(p){const s=derive(p); return `<picture><source type="image/webp" srcset="${s.webp800} 800w, ${s.webp1600} 1600w" sizes="(min-width: 900px) 25vw, 50vw"><img src="${s.jpg1600}" alt="" loading="lazy" decoding="async" onerror="this.onerror=null; this.src='${s.original}';"></picture>`;}
function render(){const id=select?.value||''; let photos=[]; if(id){const d=data.find(x=>x.id===id); photos=(d&&d.photos)||[];} else {photos=(data||[]).flatMap(d=>d.photos||[]);} gallery.innerHTML = photos.length ? photos.map(pic).join('') : '<p>Noch keine Fotos.</p>'; }
select?.addEventListener('change', render); render();})();